---
title: "Test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Load up CSAT data and merge with grant ID
REACH_data11_12
SBIRT_data11_12
SPARS_rawdata_11.13.2020_C-MAT
```{r}
setwd("T:/CRI_Research/telehealth_evaluation/CCHBC_big_picture/social_determinants_of_health_docs/Data/mat_data")
c_mat = read.csv("SPARS_rawdata_11.13.2020_C-MAT.csv", header = TRUE, na.strings = c(-9, -1, -8, -7, -6, -5))
c_mat

c_mat = subset(c_mat, InterviewType == 1 | InterviewType == 2)
### Only include those who we conducted an interview for
library(lubridate)
c_mat$InterviewDate = mdy(c_mat$InterviewDate)
range(c_mat$InterviewDate, na.rm = TRUE)
### Create telehealth variable
c_mat$telehealth = ifelse(c_mat$InterviewDate >= "2020-04-01", 1, 0)
######## Keep only the relevant variables
# ClientID
c_mat = c_mat[c("ClientID", "InterviewType", "InterviewDate", "Icd10CodeOne", "Age", "Employment", "Gender", "HispanicLatino", "Veteran", "RaceWhite", "DAUseAlcoholDays", "DAUseIllegDrugsDays", "CocaineCrackDays", "MarijuanaHashDays", "OpiatesHeroinDays", "OpiatesMorphineDays", "OpiatesDiluadidDays", "OpiatesDemerolDays", "OpiatesPercocetDays", "OpiatesDarvonDays", "OpiatesCodeineDays", "OpiatesTylenolDays", "OpiatesOxycoDays", "NonPresMethadoneDays", "HallucPsychDays", "MethamDays", "BenzodiazepinesDays", "BarbituatesDays", "NonPrescGhbDays", "KetamineDays", "OtherTranquilizersDays", "InhalantsDays", "OtherIllegalDrugsDays", "InjectedDrugs", "LivingWhere", "LivingConditionsSatisfaction", "ImpactStress", "ImpactActivity", "ImpactEmotional", "EducationYears", "ArrestedDays", "NrCrimes", "LifeQuality", "HealthSatisfaction", "EnoughEnergyForEverydayLife", "PerformDailyActivitiesSatisfaction", "SelfSatisfaction", "Depression", "Anxiety", "ViolentBehavior", "Suicide", "PsycholEmotMedication", "PsycholEmotImpact", "AnyViolence", "PhysicallyHurt", "telehealth")]
### Get just 6-month data
c_mat_month6 = subset(c_mat, InterviewType == 2)
## Get rid of NAs in Interview date
c_mat_month6 = subset(c_mat_month6, InterviewDate > "2000-01-01")
c_mat_month6$telehealth = ifelse(c_mat_month6$InterviewDate >= "2020-04-01", 1, 0)

library(naniar)
## Check out missingness
miss_var_summary(c_mat_month6)
c_mat_month6_complete = na.omit(c_mat_month6)
describe.factor(c_mat_month6_complete$telehealth)
### Create average variable for substance days 
c_mat_month6_complete$substance_days = apply(c_mat_month6_complete[11:33], 1, mean)
#### Lower numbers are better
#### Composite score, "ImpactStress", "ImpactActivity", "ImpactEmotional"
c_mat_month6_complete$impact = apply(c_mat_month6_complete[37:39], 1, mean)
### satisfaction 
c_mat_month6_complete$sat = apply(c_mat_month6_complete[43:47], 1, mean)
### Dep and Anxeity
c_mat_month6_complete$dep_anx = apply(c_mat_month6_complete[48:49], 1, mean)
### violent / suicide
c_mat_month6_complete$vio_suc = apply(c_mat_month6_complete[50:51], 1, mean)

```
CMAT descriptives
```{r}
apply(c_mat_month6_complete, 2, function(x){describe.factor(x)})

```
CMAT days, sat, and dep_anx just mean differences
```{r}
library(descr)
library(tibble)
means_compare_dat = c_mat_month6_complete[c("impact", "substance_days", "sat", "dep_anx")]
out_means_compare = list()

for(i in 1:length(means_compare_dat)){
  out_means_compare[[i]] = compmeans(means_compare_dat[[i]], c_mat_month6_complete$telehealth)
}

out_means_compare

```






Load of REDCap data
REDCap_rawdata_11.13.2020_C-MAT
```{r}
setwd("T:/CRI_Research/telehealth_evaluation/CCHBC_big_picture/social_determinants_of_health_docs/Data/mat_data")

c_mat_redcap = read.csv("REDCap_rawdata_11.13.2020_C-MAT.csv", header = TRUE)
head(c_mat_redcap)
c_mat_redcap_6_month = subset(c_mat_redcap,redcap_event_name  == "6_month_followup_arm_1")
dim(c_mat_redcap_6_month)
c_mat_redcap_6_month$ssi_aod_date  = mdy(c_mat_redcap_6_month$ssi_aod_date) 
range(c_mat_redcap_6_month$ssi_aod_date, na.rm = TRUE)

c_mat_redcap_6_month = subset(c_mat_redcap_6_month, ssi_aod_date > "2000-01-01") 
c_mat_redcap_6_month$telehealth = ifelse(c_mat_redcap_6_month$ssi_aod_date >= "2020-04-01", 1, 0)
library(prettyR)
dim(c_mat_redcap_6_month)[1]
describe.factor(c_mat_redcap_6_month$telehealth)
#### Not enough data
```
Load in BARC-10 data












